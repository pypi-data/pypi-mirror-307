export const id=72069;export const ids=[72069];export const modules={72069:(t,e,a)=>{a.a(t,(async(t,r)=>{try{a.r(e),a.d(e,{HuiEnergyUsageGraphCard:()=>v});var s=a(36312),o=(a(89655),a(24545),a(51855),a(82130),a(31743),a(22328),a(4959),a(62435),a(253),a(2075),a(54846),a(4525),a(34953)),i=a(59298),n=a(28514),d=a(15112),c=a(77706),l=a(85323),h=a(94100),_=a(23469),u=a(57636),g=(a(90701),a(13082),a(47076)),y=a(4826),f=a(20712),p=a(7934),b=a(37334),m=t([u,g,b]);[u,g,b]=m.then?(await m)():m;const k={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"};let v=(0,s.A)([(0,c.EM)("hui-energy-usage-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,c.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_chartData",value:()=>({datasets:[]})},{kind:"field",decorators:[(0,c.wk)()],key:"_start",value:()=>(0,o.R)()},{kind:"field",decorators:[(0,c.wk)()],key:"_end",value:()=>(0,i.o)()},{kind:"field",decorators:[(0,c.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){return[(0,g.tb)(this.hass,{key:this._config?.collection_key}).subscribe((t=>this._getStatistics(t)))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,p.xP)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?d.qy` <ha-card> ${this._config.title?d.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,l.H)({"has-header":!!this._config.title})}"> <ha-chart-base .hass="${this.hass}" .data="${this._chartData}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd)}" chart-type="bar"></ha-chart-base> ${this._chartData.datasets.some((t=>t.data.length))?"":d.qy`<div class="no-data"> ${(0,n.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")} </div>`} </div> </ha-card> `:d.s6}},{kind:"field",key:"_createOptions",value(){return(0,h.A)(((t,e,a,r,s,o)=>{const i=(0,b.o)(t,e,a,r,"kWh",s,o);return{...i,plugins:{...i.plugins,tooltip:{...i.plugins.tooltip,itemSort:function(t,e){return t.raw?.y>0&&e.raw?.y<0?-1:e.raw?.y>0&&t.raw?.y<0?1:t.raw?.y>0?e.datasetIndex-t.datasetIndex:t.datasetIndex-e.datasetIndex},callbacks:{...i.plugins.tooltip.callbacks,footer:t=>{let e=0,r=0;for(const a of t){const t=a.dataset.data[a.dataIndex].y;t>0?e+=t:r+=Math.abs(t)}return[e?this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,u.ZV)(e,a)}):"",r?this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,u.ZV)(r,a)}):""].filter(Boolean)}}}}}}))}},{kind:"method",key:"_getStatistics",value:async function(t){const e=[],a={};for(const e of t.prefs.energy_sources)if("solar"!==e.type)if("battery"!==e.type){if("grid"===e.type){for(const t of e.flow_from)a.from_grid?a.from_grid.push(t.stat_energy_from):a.from_grid=[t.stat_energy_from];for(const t of e.flow_to)a.to_grid?a.to_grid.push(t.stat_energy_to):a.to_grid=[t.stat_energy_to]}}else a.to_battery?(a.to_battery.push(e.stat_energy_to),a.from_battery.push(e.stat_energy_from)):(a.to_battery=[e.stat_energy_to],a.from_battery=[e.stat_energy_from]);else a.solar?a.solar.push(e.stat_energy_from):a.solar=[e.stat_energy_from];const r=getComputedStyle(this),s={};Object.keys(k).forEach((t=>{s[t]={},"used_grid"!==t&&"used_solar"!==t&&"used_battery"!==t&&a[t]&&Object.values(a[t]).forEach(((e,a)=>{s[t][e]=a}))}));const o={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")};this._start=t.start,this._end=t.end||(0,i.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,e.push(...this._processDataSet(t.stats,t.statsMetadata,a,s,r,o,!1)),t.statsCompare&&(e.push({order:0,data:[]}),e.push({order:999,data:[],xAxisID:"xAxisCompare"}),e.push(...this._processDataSet(t.statsCompare,t.statsMetadata,a,s,r,o,!0))),this._chartData={datasets:e}}},{kind:"method",key:"_processDataSet",value:function(t,e,a,r,s,o,i=!1){const n=[],d={},c={};let l;Object.entries(a).forEach((([e,a])=>{const r=["solar","to_grid","from_grid","to_battery","from_battery"].includes(e),s=!["solar","from_battery"].includes(e),o={},i={};a.forEach((e=>{const a=t[e];if(!a)return;const n={};a.forEach((t=>{if(null===t.change||void 0===t.change)return;const e=t.change;r&&(o[t.start]=t.start in o?o[t.start]+e:e,l=t.end),s&&!(t.start in n)&&(n[t.start]=e,l=t.end)})),i[e]=n})),r&&(c[e]=o),s&&(d[e]=i)}));const h={},u={};if((c.to_grid||c.to_battery)&&c.solar){const t={};for(const e of Object.keys(c.solar))t[e]=(c.solar[e]||0)-(c.to_grid?.[e]||0)-(c.to_battery?.[e]||0),t[e]<0&&(c.to_battery&&(h[e]=-1*t[e],h[e]>(c.from_grid?.[e]||0)&&(u[e]=h[e]-(c.from_grid?.[e]||0),h[e]=c.from_grid?.[e])),t[e]=0);d.used_solar={used_solar:t}}if(c.from_battery)if(c.to_grid){const t={};for(const e of Object.keys(c.from_battery))t[e]=(c.from_battery[e]||0)-(u[e]||0);d.used_battery={used_battery:t}}else d.used_battery={used_battery:c.from_battery};if(d.from_grid&&c.to_battery){const t={};for(const e of Object.keys(h)){let a,r=0;for(const[t,s]of Object.entries(d.from_grid))if(s[e]&&(a=t,r++),r>1)break;if(1===r)d.from_grid[a][e]-=h[e]||0;else{let a=0;Object.values(d.from_grid).forEach((t=>{a+=t[e]||0,delete t[e]})),t[e]=a-(h[e]||0)}}d.used_grid={used_grid:t}}let g=[];Object.values(d).forEach((t=>{Object.values(t).forEach((t=>{g=g.concat(Object.keys(t))}))}));const f=Array.from(new Set(g)).sort(((t,e)=>Number(t)-Number(e)));return Object.entries(d).forEach((([t,a])=>{Object.entries(a).forEach((([a,c],h)=>{const u=[];for(const e of f){const a=c[e]||0;u.push({x:Number(e),y:a&&["to_grid","to_battery"].includes(t)?-1*a:a})}1===u.length&&u.push({x:l,y:0}),n.push({label:t in o?o[t]:(0,y.$O)(this.hass,a,e[a]),order:"used_solar"===t?1:"to_battery"===t?Object.keys(d).length:h+2,borderColor:(0,_.g)(s,this.hass.themes.darkMode,!1,i,k[t],r[t]?.[a]),backgroundColor:(0,_.g)(s,this.hass.themes.darkMode,!0,i,k[t],r[t]?.[a]),stack:"stack",data:u,xAxisID:i?"xAxisCompare":void 0})}))})),n}},{kind:"get",static:!0,key:"styles",value:function(){return d.AH`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}`}}]}}),(0,f.E)(d.WF));r()}catch(t){r(t)}}))}};
//# sourceMappingURL=72069.vhY-OT8gjzk.js.map