

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Annotations with arbitrary metadata &mdash; Python reimplementation of NIXIO (http://g-node.github.io/nix/) 1.5.0 Development documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Noting the origin of data" href="sources.html" />
    <link rel="prev" title="Working with data" href="data_handling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/nix_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic_idea.html">Idea</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="standardization.html">Support for standardization</a></li>
</ul>
<p class="caption"><span class="caption-text">News</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="news.html">Changes in version 1.5</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="getting_started.html#list-of-tutorials">List of tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="file_handling.html">File handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="storing_data.html">Storing data</a></li>
<li class="toctree-l3"><a class="reference internal" href="tagging.html">Tagging points and regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="tagging.html#handling-of-units">Handling of units</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_handling.html">Working with data</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Annotations with arbitrary metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="sources.html">Noting the origin of data</a></li>
<li class="toctree-l3"><a class="reference internal" href="finding_things.html">Finding things</a></li>
<li class="toctree-l3"><a class="reference internal" href="image_data.html">Image data</a></li>
<li class="toctree-l3"><a class="reference internal" href="spike_time_data.html">Spike time data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Getting support</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">High Level API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user_api.html">High Level API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Internal API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/nixio.html">nixio package</a></li>
</ul>
<p class="caption"><span class="caption-text">Source code</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/g-node/nixpy">Sources on GitHub</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python reimplementation of NIXIO (http://g-node.github.io/nix/)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="getting_started.html">Tutorials</a> &raquo;</li>
        
      <li>Annotations with arbitrary metadata</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/annotations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="sources.html" class="btn btn-neutral float-right" title="Noting the origin of data" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="data_handling.html" class="btn btn-neutral float-left" title="Working with data" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="annotations-with-arbitrary-metadata">
<span id="metadata"></span><h1>Annotations with arbitrary metadata<a class="headerlink" href="#annotations-with-arbitrary-metadata" title="Permalink to this headline">¶</a></h1>
<p>The entities of the data model that were discussed so far carry just enough information to get a basic understanding of the stored data. Often much more information than that is required. Storing additional metadata is a central part of the NIX concept. We use a slightly modified version of the <em>odML</em> data model for metadata to store additional information. In brief: the model consists of <em>Sections</em> that contain <em>Properties</em> which in turn carry a list of values. Again, <em>Sections</em> can be nested to represent logical dependencies in the hierarchy of a tree. While all data entities discussed above are children of <em>Block</em> entities, the metadata lives parallel to the <em>Blocks</em>. The idea behind this is that several blocks may refer to the same metadata, or, the other way round the metadata applies to data entities in several blocks. The <em>types</em> used for the <em>Sections</em> in the following example are defined
in the <a class="reference external" href="https://github.com/G-Node/odml-terminologies">odml terminologies</a></p>
<p>Most of the data entities can link to metadata sections.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">We can add arbitrary metadata in trees of <em>Sections</em> and <em>Properties</em> (<a class="reference download internal" download="" href="_downloads/f9168adb9ffceb6250579e038988d0d2/annotations.py"><code class="xref download docutils literal notranslate"><span class="pre">example</span> <span class="pre">code</span></code></a>).</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">nixfile</span> <span class="o">=</span> <span class="n">nixio</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;annotations.nix&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">nixio</span><span class="o">.</span><span class="n">FileMode</span><span class="o">.</span><span class="n">Overwrite</span><span class="p">)</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">nixfile</span><span class="o">.</span><span class="n">create_block</span><span class="p">(</span><span class="s2">&quot;recording 1&quot;</span><span class="p">,</span> <span class="s2">&quot;nix.session&quot;</span><span class="p">)</span>
    
    <span class="n">session</span> <span class="o">=</span> <span class="n">nixfile</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="s1">&#39;recording session&#39;</span><span class="p">,</span> <span class="s1">&#39;odml.recording&#39;</span><span class="p">)</span>
    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;experimenter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;John Doe&#39;</span>
    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;recording date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2014-01-01&#39;</span>
    
    <span class="n">subject</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;odml.subject&#39;</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mouse xyz&#39;</span>

    <span class="n">cell</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;odml.cell&#39;</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="mf">64.5</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">create_property</span><span class="p">(</span><span class="s1">&#39;resting potential&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.5</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">uncertainty</span> <span class="o">=</span> <span class="mf">2.25</span>
    <span class="n">p</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;mV&#39;</span>

    <span class="c1"># set the recording block metadata</span>
    <span class="n">block</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">session</span>
</pre></div>
</div>
</div>
<p>For a quick view of the metadata tree pretty-print it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">block</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>which leads to an output like this. The argument <code class="docutils literal notranslate"><span class="pre">max_depth=-1</span></code> notes that the full depth of the tree should be displayed. In the default case (<code class="docutils literal notranslate"><span class="pre">max_depth=1</span></code>) the display will be more compact and will not recursively traverse the whole tree.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>recording session [odml.recording]
    |- experimenter: (&#39;John Doe&#39;,)
    |- recording date: (&#39;2014-01-01&#39;,)
subject [odml.subject]
    |- id: (&#39;mouse xyz&#39;,)
    cell [odml.cell]
        |- resting potential: (-64.5,)mV
</pre></div>
</div>
<p>The <em>Sections</em> add much like dictionaries. To access e.g. the “resting potential” of the cell we may call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">block</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If we do not know the exact path of the <em>Section</em> we are looking for, we need to search it by passing a function (in this case a lambda function) to the <code class="docutils literal notranslate"><span class="pre">find_section</span></code> method. The following code shows two examples in which we look first for a section with a given name or second a section which contains a property with a certain name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">find_sections</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;cell&quot;</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">find_sections</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s2">&quot;resting potential&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">props</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">find_sections</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s2">&quot;resting potential&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">props</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;resting potential&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>The result of the <code class="docutils literal notranslate"><span class="pre">find_sections</span></code> will always be list which may be empty if no match was found. Therefore, the call in the last line is to some extent risky and would lead to an OutOfBounds exception if the search failed.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sources.html" class="btn btn-neutral float-right" title="Noting the origin of data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="data_handling.html" class="btn btn-neutral float-left" title="Working with data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2014-2020, German Neuroinformatics Node, Christian Kellner, Adrian Stoewer, Andrey Sobolev, Jan Grewe, Balint Morvai, Achilleas Koutsou.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>