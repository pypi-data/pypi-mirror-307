(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8423],{38423:function(e,t,n){"use strict";n.d(t,{a:function(){return S}});var a=n(57437),s=n(37649),r=n.n(s),l=n(2265),o=n(11838),i=n.n(o);n(7395);var c=n(35719),d=n(86819),u=n(77689),h=n(86829),f=n(33009),g=n(51091),m=n(82119),x=n(42491),p=n(6780),j=n(50495),b=n(70571),v=n(19573),w=n(61485),y=n(93146),N=n(19666),C=n(58575),k=n(66820),R=n(9557),D=n(58485),E=n(89417);let S=(0,l.forwardRef)((e,t)=>{let[n,s]=(0,l.useState)(""),o=(0,l.useRef)(null),[S,O]=(0,l.useState)(null),[T,z]=(0,l.useState)(null),[M,I]=(0,l.useState)(!1),[_,L]=(0,l.useState)(null),[A,U]=(0,l.useState)(!1),[F,P]=(0,l.useState)(!1),[W,Y]=(0,l.useState)([]),[$,J]=(0,l.useState)([]),[H,K]=(0,l.useState)(!1),[B,Z]=(0,l.useState)(null),[V,X]=(0,l.useState)(0),[q,G]=(0,l.useState)(!1),[Q,ee]=(0,l.useState)(!1),[et,en]=(0,l.useState)(e.isResearchModeEnabled||!1);function ea(){if(F&&(P(!1),Y([]),$.forEach(t=>e.sendImage(t))),!n.trim())return;if(!e.isLoggedIn){L("Hey there, you need to be signed in to send messages to Khoj AI"),U(!0);return}let t=n.trim();et&&!t.startsWith("/research")&&(t="/research ".concat(t)),e.sendMessage(t),s("")}function es(n){var a,s;if(!e.isLoggedIn){L("Please login to chat with your files"),U(!0);return}let r=["jpg","jpeg","png","webp"],l=[];for(let e=0;e<n.length;e++){let t=n[e],a=t.name.split(".").pop();r.includes(a||"")&&l.push(i().sanitize(URL.createObjectURL(t)))}if(l.length>0){P(!0),Y(e=>[...e,...l]),null==t||null===(s=t.current)||void 0===s||s.focus();return}(0,R.ko)(n,O,I,z,e.setUploadedFiles,e.conversationId),null==t||null===(a=t.current)||void 0===a||a.focus()}async function er(){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e,{mimeType:"audio/webm"}),n=[];t.ondataavailable=async e=>{n.push(e.data);let t=new Blob(n,{type:"audio/webm"}),a=new FormData;a.append("file",t);try{let e=await fetch("/api/transcribe",{method:"POST",body:a});if(!e.ok)throw Error("Network response was not ok");let t=await e.json();s(t.text.trim())}catch(e){console.error("Error sending audio to server:",e)}},t.start(1500),t.onstop=async()=>{let e=new Blob(n,{type:"audio/webm"}),a=new FormData;a.append("file",e);try{let e=await fetch("/api/transcribe",{method:"POST",body:a});if(!e.ok)throw Error("Network response was not ok");let n=await e.json();t.stream.getTracks().forEach(e=>e.stop()),Z(null),s(n.text.trim())}catch(e){console.error("Error sending audio to server:",e)}},Z(t)}catch(e){console.error("Error getting microphone",e)}}return(0,l.useEffect)(()=>{if(M||X(0),M){let e=setInterval(()=>{X(e=>{let t=e+(Math.floor(5*Math.random())+1);return t<100?t:100})},800);return()=>clearInterval(e)}},[M]),(0,l.useEffect)(()=>{async function e(){W.length>0&&J(await Promise.all(W.map(async e=>{let t=await fetch(e),n=await t.blob();return new Promise(e=>{let t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(n)})}))),I(!1)}I(!0),e()},[W]),(0,l.useEffect)(()=>{e.isResearchModeEnabled&&en(e.isResearchModeEnabled)},[e.isResearchModeEnabled]),(0,l.useEffect)(()=>{!H&&B&&B.stop(),H&&!B&&er()},[H,B]),(0,l.useEffect)(()=>{(null==t?void 0:t.current)&&(t.current.style.height="auto",t.current.style.height=Math.max(t.current.scrollHeight-24,64)+"px",n.startsWith("/")&&1===n.split(" ").length?ee(!0):ee(!1))},[n]),(0,a.jsxs)(a.Fragment,{children:[A&&_&&(0,a.jsx)(k.Z,{onOpenChange:U,loginRedirectMessage:_}),M&&(0,a.jsx)(p.aR,{open:M,children:(0,a.jsxs)(p._T,{children:[(0,a.jsx)(p.fY,{children:(0,a.jsx)(p.f$,{children:"Uploading data. Please wait."})}),(0,a.jsx)(p.yT,{children:(0,a.jsx)(b.E,{indicatorColor:"bg-slate-500",className:"w-full h-2 rounded-full",value:V})}),(0,a.jsx)(p.OL,{className:"bg-slate-400 hover:bg-slate-500",onClick:()=>I(!1),children:"Dismiss"})]})}),S&&(0,a.jsx)(p.aR,{open:null!==S,children:(0,a.jsxs)(p._T,{children:[(0,a.jsx)(p.fY,{children:(0,a.jsx)(p.f$,{children:"Data Upload Warning"})}),(0,a.jsx)(p.yT,{children:S}),(0,a.jsx)(p.OL,{className:"bg-slate-400 hover:bg-slate-500",onClick:()=>O(null),children:"Close"})]})}),T&&(0,a.jsx)(p.aR,{open:null!==T,children:(0,a.jsxs)(p._T,{children:[(0,a.jsxs)(p.fY,{children:[(0,a.jsx)(p.f$,{children:"Oh no!"}),(0,a.jsx)(p.yT,{children:"Something went wrong while uploading your data"})]}),(0,a.jsx)(p.yT,{children:T}),(0,a.jsx)(p.OL,{className:"bg-slate-400 hover:bg-slate-500",onClick:()=>z(null),children:"Close"})]})}),Q&&(0,a.jsx)("div",{className:"flex justify-center text-center",children:(0,a.jsxs)(v.J2,{open:Q,onOpenChange:ee,children:[(0,a.jsx)(w.xo,{className:"flex justify-center text-center"}),(0,a.jsx)(v.yk,{onOpenAutoFocus:e=>e.preventDefault(),className:"".concat(e.isMobileWidth?"w-[100vw]":"w-full"," rounded-md"),side:"bottom",align:"center",sideOffset:e.conversationId?0:80,alignOffset:0,children:(0,a.jsxs)(x.mY,{className:"max-w-full",children:[(0,a.jsx)(x.sZ,{placeholder:"Type a command or search...",value:n,className:"hidden"}),(0,a.jsxs)(x.e8,{children:[(0,a.jsx)(x.rb,{children:"No matching commands."}),(0,a.jsx)(x.fu,{heading:"Agent Tools",children:e.chatOptionsData&&Object.entries(e.chatOptionsData).map(e=>{let[t,n]=e;return(0,a.jsx)(x.di,{className:"text-md",onSelect:()=>{s("/".concat(t," "))},children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-1",children:[(0,a.jsxs)("div",{className:"font-bold flex items-center",children:[(0,E.vH)(t,"h-4 w-4 mr-2"),"/",t]}),(0,a.jsx)("div",{children:n})]})},t)})}),(0,a.jsx)(x.zz,{})]})]})})]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"".concat(r().actualInputArea," justify-between dark:bg-neutral-700 relative ").concat(q&&"animate-pulse"),onDragOver:function(e){e.preventDefault(),G(!0)},onDragLeave:function(e){e.preventDefault(),G(!1)},onDrop:function(e){e.preventDefault(),G(!1),e.dataTransfer.files&&es(e.dataTransfer.files)},children:[(0,a.jsx)("input",{type:"file",multiple:!0,ref:o,onChange:function(e){e.target.files&&es(e.target.files)},style:{display:"none"}}),(0,a.jsx)("div",{className:"flex items-end pb-2",children:(0,a.jsx)(j.z,{variant:"ghost",className:"!bg-none p-0 m-2 h-auto text-3xl rounded-full text-gray-300 hover:text-gray-500",disabled:e.sendDisabled,onClick:function(){o.current&&o.current.click()},children:(0,a.jsx)(c.p,{className:"w-8 h-8"})})}),(0,a.jsxs)("div",{className:"flex-grow flex flex-col w-full gap-1.5 relative",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto",children:F&&W.map((e,t)=>(0,a.jsxs)("div",{className:"relative flex-shrink-0 pb-3 pt-2 group",children:[(0,a.jsx)("img",{src:e,alt:"img-".concat(t),className:"w-auto h-16 object-cover rounded-xl"}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",className:"absolute -top-0 -right-2 h-5 w-5 rounded-full bg-neutral-200 dark:bg-neutral-600 hover:bg-neutral-300 dark:hover:bg-neutral-500 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{Y(e=>e.filter((e,n)=>n!==t)),J(e=>e.filter((e,n)=>n!==t)),1===W.length&&P(!1)},children:(0,a.jsx)(d.X,{className:"h-3 w-3"})})]},t))}),(0,a.jsx)(y.g,{ref:t,className:"border-none focus:border-none\n                                focus:outline-none focus-visible:ring-transparent\n                                w-full h-16 min-h-16 max-h-[128px] md:py-4 rounded-lg resize-none dark:bg-neutral-700\n                                ".concat(e.isMobileWidth?"text-md":"text-lg"),placeholder:"Type / to see a list of commands",id:"message",autoFocus:!0,value:n,onKeyDown:t=>{"Enter"!==t.key||t.shiftKey||e.isMobileWidth||(P(!1),Y([]),t.preventDefault(),ea())},onChange:e=>s(e.target.value),disabled:e.sendDisabled||H})]}),(0,a.jsxs)("div",{className:"flex items-end pb-2",children:[H?(0,a.jsx)(N.pn,{children:(0,a.jsxs)(N.u,{children:[(0,a.jsx)(N.aJ,{asChild:!0,children:(0,a.jsx)(j.z,{variant:"default",className:"".concat(!H&&"hidden"," ").concat(e.agentColor?(0,C.tp)(e.agentColor):"bg-orange-300 hover:bg-orange-500"," rounded-full p-1 m-2 h-auto text-3xl transition transform md:hover:-translate-y-1"),onClick:()=>{K(!H)},disabled:e.sendDisabled,children:(0,a.jsx)(u.d,{weight:"fill",className:"w-6 h-6"})})}),(0,a.jsx)(N._v,{children:"Click to stop recording and transcribe your voice."})]})}):B?(0,a.jsx)(D.l,{}):(0,a.jsx)(N.pn,{children:(0,a.jsxs)(N.u,{children:[(0,a.jsx)(N.aJ,{asChild:!0,children:(0,a.jsx)(j.z,{variant:"default",className:"".concat(!n||H||"hidden"," ").concat(e.agentColor?(0,C.tp)(e.agentColor):"bg-orange-300 hover:bg-orange-500"," rounded-full p-1 m-2 h-auto text-3xl transition transform md:hover:-translate-y-1"),onClick:()=>{s("Listening..."),K(!H)},disabled:e.sendDisabled,children:(0,a.jsx)(h.P,{weight:"fill",className:"w-6 h-6"})})}),(0,a.jsx)(N._v,{children:"Click to transcribe your message with voice."})]})}),(0,a.jsx)(j.z,{className:"".concat((!n||H)&&"hidden"," ").concat(e.agentColor?(0,C.tp)(e.agentColor):"bg-orange-300 hover:bg-orange-500"," rounded-full p-1 m-2 h-auto text-3xl transition transform md:hover:-translate-y-1"),onClick:ea,disabled:e.sendDisabled,children:(0,a.jsx)(f.a,{className:"w-6 h-6",weight:"bold"})})]})]}),(0,a.jsx)(N.pn,{children:(0,a.jsxs)(N.u,{children:[(0,a.jsx)(N.aJ,{asChild:!0,children:(0,a.jsxs)(j.z,{variant:"ghost",className:"float-right justify-center gap-1 flex items-center p-1.5 mr-2 h-fit",onClick:()=>{var e;en(!et),null==t||null===(e=t.current)||void 0===e||e.focus()},children:[(0,a.jsx)("span",{className:"text-muted-foreground text-sm",children:"Research Mode"}),et?(0,a.jsx)(g.W,{className:"w-6 h-6 inline-block ".concat(e.agentColor?(0,C.oz)(e.agentColor):(0,C.oz)("orange")," rounded-full")}):(0,a.jsx)(m.$,{className:"w-6 h-6 inline-block rounded-full"})]})}),(0,a.jsx)(N._v,{className:"text-xs",children:"(Experimental) Research Mode allows you to get more deeply researched, detailed responses. Response times may be longer."})]})})]})]})});S.displayName="ChatInputArea"},66820:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(57437),s=n(6780),r=n(87138);function l(e){return(0,a.jsx)(s.aR,{open:!0,onOpenChange:e.onOpenChange,children:(0,a.jsxs)(s._T,{children:[(0,a.jsx)(s.fY,{children:(0,a.jsx)(s.f$,{children:"Sign in to Khoj to continue"})}),(0,a.jsxs)(s.yT,{children:[e.loginRedirectMessage,". By logging in, you agree to our"," ",(0,a.jsx)(r.default,{href:"https://khoj.dev/terms-of-service",children:"Terms of Service."})]}),(0,a.jsxs)(s.xo,{children:[(0,a.jsx)(s.le,{children:"Dismiss"}),(0,a.jsx)(s.OL,{className:"bg-slate-400 hover:bg-slate-500",onClick:()=>{window.location.href="/login?next=".concat(encodeURIComponent(window.location.pathname))},children:(0,a.jsxs)(r.default,{href:"/login?next=".concat(encodeURIComponent(window.location.pathname)),children:[" ","Login"]})})]})]})})}},70571:function(e,t,n){"use strict";n.d(t,{E:function(){return o}});var a=n(57437),s=n(2265),r=n(52431),l=n(37440);let o=s.forwardRef((e,t)=>{let{className:n,value:s,indicatorColor:o,...i}=e;return(0,a.jsx)(r.fC,{ref:t,className:(0,l.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",n),...i,children:(0,a.jsx)(r.z$,{className:"h-full w-full flex-1 bg-primary transition-all ".concat(o),style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});o.displayName=r.fC.displayName},93146:function(e,t,n){"use strict";n.d(t,{g:function(){return l}});var a=n(57437),s=n(2265),r=n(37440);let l=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...s})});l.displayName="Textarea"},19666:function(e,t,n){"use strict";n.d(t,{_v:function(){return d},aJ:function(){return c},pn:function(){return o},u:function(){return i}});var a=n(57437),s=n(2265),r=n(27071),l=n(37440);let o=r.zt,i=r.fC,c=r.xz,d=s.forwardRef((e,t)=>{let{className:n,sideOffset:s=4,...o}=e;return(0,a.jsx)(r.VY,{ref:t,sideOffset:s,className:(0,l.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o})});d.displayName=r.VY.displayName},37649:function(e){e.exports={actualInputArea:"chatInputArea_actualInputArea__Ha6cN"}}}]);