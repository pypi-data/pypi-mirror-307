(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1467],{81467:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var a=n(57437),o=n(15238),s=n.n(o),l=n(2265),r=n(53423),i=n(94880),c=n(58485),u=n(52195);let d=new Map([["bold",l.createElement(l.Fragment,null,l.createElement("path",{d:"M168.49,104.49,145,128l23.52,23.51a12,12,0,0,1-17,17L128,145l-23.51,23.52a12,12,0,0,1-17-17L111,128,87.51,104.49a12,12,0,0,1,17-17L128,111l23.51-23.52a12,12,0,0,1,17,17ZM236,128A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Z"}))],["duotone",l.createElement(l.Fragment,null,l.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),l.createElement("path",{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["fill",l.createElement(l.Fragment,null,l.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm37.66,130.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32L139.31,128Z"}))],["light",l.createElement(l.Fragment,null,l.createElement("path",{d:"M164.24,100.24,136.48,128l27.76,27.76a6,6,0,1,1-8.48,8.48L128,136.48l-27.76,27.76a6,6,0,0,1-8.48-8.48L119.52,128,91.76,100.24a6,6,0,0,1,8.48-8.48L128,119.52l27.76-27.76a6,6,0,0,1,8.48,8.48ZM230,128A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"}))],["regular",l.createElement(l.Fragment,null,l.createElement("path",{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["thin",l.createElement(l.Fragment,null,l.createElement("path",{d:"M162.83,98.83,133.66,128l29.17,29.17a4,4,0,0,1-5.66,5.66L128,133.66,98.83,162.83a4,4,0,0,1-5.66-5.66L122.34,128,93.17,98.83a4,4,0,0,1,5.66-5.66L128,122.34l29.17-29.17a4,4,0,1,1,5.66,5.66ZM228,128A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"}))]]);var g=Object.defineProperty,h=Object.defineProperties,m=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,x=(e,t,n)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))f.call(t,n)&&x(e,n,t[n]);if(v)for(var n of v(t))p.call(t,n)&&x(e,n,t[n]);return e},b=(e,t)=>h(e,m(t));let j=(0,l.forwardRef)((e,t)=>l.createElement(u.Z,b(y({ref:t},e),{weights:d})));j.displayName="XCircle";var M=n(16288),I=n(20721),C=n(26100),w=n(19666),N=n(50495),L=e=>{let{name:t,avatar:n,link:o,description:s}=e;return(0,a.jsx)("div",{className:"relative group flex",children:(0,a.jsx)(w.pn,{children:(0,a.jsxs)(w.u,{delayDuration:0,children:[(0,a.jsx)(w.aJ,{asChild:!0,children:(0,a.jsxs)(N.z,{variant:"ghost",className:"flex items-center justify-center",children:[n,(0,a.jsx)("div",{children:t})]})}),(0,a.jsx)(w._v,{children:(0,a.jsxs)("div",{className:"w-80 h-30",children:[(0,a.jsx)("a",{href:o,target:"_blank",rel:"noreferrer",className:"mt-1 ml-2 block no-underline",children:(0,a.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[n,(0,a.jsxs)("div",{className:"mr-2 mt-1 flex justify-center items-center text-sm font-semibold text-gray-800",children:[t,(0,a.jsx)(C.o,{weight:"bold",className:"ml-1"})]})]})}),s&&(0,a.jsx)("p",{className:"mt-2 ml-6 text-sm text-gray-600 line-clamp-2",children:s||"A Khoj agent"})]})})]})})})},O=n(89417),E=n(69591);function Z(e){let t=e.trainOfThought.length-1,[n,o]=(0,l.useState)(e.completed);return(0,a.jsxs)("div",{className:"".concat(n?"":s().trainOfThought+" shadow-sm"),children:[!e.completed&&(0,a.jsx)(c.l,{className:"float-right"}),e.completed&&(n?(0,a.jsx)(N.z,{className:"w-fit text-left justify-start content-start text-xs",onClick:()=>o(!1),variant:"ghost",size:"sm",children:"What was my train of thought?"}):(0,a.jsxs)(N.z,{className:"w-fit text-left justify-start content-start text-xs p-0 h-fit",onClick:()=>o(!0),variant:"ghost",size:"sm",children:[(0,a.jsx)(j,{size:16,className:"mr-1"}),"Close"]})),!n&&e.trainOfThought.map((n,o)=>(0,a.jsx)(r.H,{message:n,primary:o===t&&e.lastMessage&&!e.completed,agentColor:e.agentColor},"train-".concat(o)))]},e.keyId)}function T(e){var t,n,o,u,d,g,h,m,v;let[f,p]=(0,l.useState)(null),[x,y]=(0,l.useState)(0),[b,j]=(0,l.useState)(!0),[C,w]=(0,l.useState)(null),N=(0,l.useRef)(null),T=(0,l.useRef)(null),_=(0,l.useRef)(null),k=(0,l.useRef)(null),[A,S]=(0,l.useState)(null),[H,F]=(0,l.useState)(!1),[q,z]=(0,l.useState)(!0),R=(0,E.IC)(),D="[data-radix-scroll-area-viewport]";(0,l.useEffect)(()=>{var e;let t=null===(e=T.current)||void 0===e?void 0:e.querySelector(D);if(!t)return;let n=()=>{let{scrollTop:e,scrollHeight:n,clientHeight:a}=t;z(n-(e+a)<=50)};return t.addEventListener("scroll",n),()=>t.removeEventListener("scroll",n)},[]),(0,l.useEffect)(()=>{e.incomingMessages&&e.incomingMessages.length>0&&q&&W()},[e.incomingMessages,q]),(0,l.useEffect)(()=>{f&&f.chat&&f.chat.length>0&&x<2&&requestAnimationFrame(()=>{var e;null===(e=_.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"})})},[f,x]),(0,l.useEffect)(()=>{if(!b||H)return;let t=new IntersectionObserver(t=>{t[0].isIntersecting&&b&&(F(!0),function(t){if(!b||H)return;let n=(t+1)*10,a="";if(e.conversationId)a="/api/chat/history?client=web&conversation_id=".concat(encodeURIComponent(e.conversationId),"&n=").concat(n);else{if(!e.publicConversationSlug)return;a="/api/chat/share/history?client=web&public_conversation_slug=".concat(e.publicConversationSlug,"&n=").concat(n)}fetch(a).then(e=>e.json()).then(n=>{if(e.setTitle(n.response.slug),n&&n.response&&n.response.chat&&n.response.chat.length>0){if(y(Math.ceil(n.response.chat.length/10)),n.response.chat.length===(null==f?void 0:f.chat.length)){j(!1),F(!1);return}e.setAgent(n.response.agent),p(n.response),F(!1),0===t?W(!0):Q()}else{if(n.response.agent&&n.response.conversation_id){let t={chat:[],agent:n.response.agent,conversation_id:n.response.conversation_id,slug:n.response.slug};e.setAgent(n.response.agent),p(t)}j(!1),F(!1)}}).catch(e=>{console.error(e),window.location.href="/"})}(x))},{threshold:1});return N.current&&t.observe(N.current),()=>t.disconnect()},[b,x,H]),(0,l.useEffect)(()=>{j(!0),F(!1),y(0),p(null)},[e.conversationId]),(0,l.useEffect)(()=>{if(e.incomingMessages){let t=e.incomingMessages[e.incomingMessages.length-1];t&&!t.completed&&(S(e.incomingMessages.length-1),e.setTitle(t.rawQuery),t.turnId&&w(t.turnId))}},[e.incomingMessages]);let Q=()=>{var e;let t=null===(e=T.current)||void 0===e?void 0:e.querySelector(D);requestAnimationFrame(()=>{var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"}),null==t||t.scrollBy({behavior:"smooth",top:-150})})},W=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=T.current)||void 0===e?void 0:e.querySelector(D);requestAnimationFrame(()=>{null==n||n.scrollTo({top:n.scrollHeight,behavior:t?"auto":"smooth"})}),z(!0)},P=t=>{t&&(p(e=>e&&t?{...e,chat:e.chat.filter(e=>e.turnId!==t)}:e),e.incomingMessages&&e.setIncomingMessages&&e.setIncomingMessages(e.incomingMessages.filter(e=>e.turnId!==t)))};return e.conversationId||e.publicConversationSlug?(0,a.jsx)(i.x,{className:"h-[73vh] relative",ref:T,children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"".concat(s().chatHistory," ").concat(e.customClassName),children:[(0,a.jsx)("div",{ref:N,style:{height:"1px"},children:H&&(0,a.jsx)(c.l,{className:"opacity-50"})}),f&&f.chat&&f.chat.map((t,n)=>{var o,s,l;return(0,a.jsxs)(a.Fragment,{children:[t.trainOfThought&&"khoj"===t.by&&(0,a.jsx)(Z,{trainOfThought:null===(o=t.trainOfThought)||void 0===o?void 0:o.map(e=>e.data),lastMessage:!1,agentColor:(null==f?void 0:null===(s=f.agent)||void 0===s?void 0:s.color)||"orange",keyId:"".concat(n,"trainOfThought"),completed:!0},"".concat(n,"trainOfThought")),(0,a.jsx)(r.Z,{ref:n===f.chat.length-2?_:n===f.chat.length-(x-1)*10?k:null,isMobileWidth:R,chatMessage:t,customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(l=f.agent)||void 0===l?void 0:l.color,"-500"),isLastMessage:n===f.chat.length-1,onDeleteMessage:P,conversationId:e.conversationId},"".concat(n,"fullHistory"))]})}),e.incomingMessages&&e.incomingMessages.map((t,n)=>{var o,s,i,c,u;let d=null!==(u=null!==(c=t.turnId)&&void 0!==c?c:C)&&void 0!==u?u:void 0;return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)(r.Z,{isMobileWidth:R,chatMessage:{message:t.rawQuery,context:[],onlineContext:{},codeContext:{},created:t.timestamp,by:"you",automationId:"",images:t.images,conversationId:e.conversationId,turnId:d},customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(o=f.agent)||void 0===o?void 0:o.color,"-500"),onDeleteMessage:P,conversationId:e.conversationId,turnId:d},"".concat(n,"outgoing")),t.trainOfThought&&(0,a.jsx)(Z,{trainOfThought:t.trainOfThought,lastMessage:n===A,agentColor:(null==f?void 0:null===(s=f.agent)||void 0===s?void 0:s.color)||"orange",keyId:"".concat(n,"trainOfThought"),completed:t.completed},"".concat(n,"trainOfThought")),(0,a.jsx)(r.Z,{isMobileWidth:R,chatMessage:{message:t.rawResponse,context:t.context,onlineContext:t.onlineContext,codeContext:t.codeContext,created:t.timestamp,by:"khoj",automationId:"",rawQuery:t.rawQuery,intent:{type:t.intentType||"",query:t.rawQuery,"memory-type":"","inferred-queries":t.inferredQueries||[]},conversationId:e.conversationId,turnId:d},conversationId:e.conversationId,turnId:d,onDeleteMessage:P,customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(i=f.agent)||void 0===i?void 0:i.color,"-500"),isLastMessage:!0},"".concat(n,"incoming"))]},"incomingMessage".concat(n))}),e.pendingMessage&&(0,a.jsx)(r.Z,{isMobileWidth:R,chatMessage:{message:e.pendingMessage,context:[],onlineContext:{},codeContext:{},created:new Date().getTime().toString(),by:"you",automationId:"",conversationId:e.conversationId,turnId:void 0},conversationId:e.conversationId,onDeleteMessage:P,customClassName:"fullHistory",borderLeftColor:"".concat(null==f?void 0:null===(t=f.agent)||void 0===t?void 0:t.color,"-500"),isLastMessage:!0},"pendingMessage-".concat(e.pendingMessage.length)),f&&(0,a.jsx)("div",{className:"".concat(s().agentIndicator," pb-4"),children:(0,a.jsx)("div",{className:"relative group mx-2 cursor-pointer",children:(0,a.jsx)(L,{name:f&&f.agent&&(null===(u=f.agent)||void 0===u?void 0:u.name)?null===(d=f.agent)||void 0===d?void 0:d.name:"Agent",link:f&&f.agent&&(null===(g=f.agent)||void 0===g?void 0:g.slug)?"/agents?agent=".concat(null===(h=f.agent)||void 0===h?void 0:h.slug):"/agents",avatar:(0,O.TI)(null===(n=f.agent)||void 0===n?void 0:n.icon,null===(o=f.agent)||void 0===o?void 0:o.color)||(0,a.jsx)(M.v,{}),description:f&&f.agent&&(null===(m=f.agent)||void 0===m?void 0:m.persona)?null===(v=f.agent)||void 0===v?void 0:v.persona:"Your agent is no longer available. You will be reset to the default agent."})})})]}),(0,a.jsx)("div",{className:"".concat(e.customClassName," fixed bottom-[20%] z-10"),children:!q&&(0,a.jsx)("button",{title:"Scroll to bottom",className:"absolute bottom-0 right-0 bg-white dark:bg-[hsl(var(--background))] text-neutral-500 dark:text-white p-2 rounded-full shadow-xl",onClick:()=>{W(),z(!0)},children:(0,a.jsx)(I.K,{size:24})})})]})}):null}},15238:function(e){e.exports={chatHistory:"chatHistory_chatHistory__CoaVT",agentIndicator:"chatHistory_agentIndicator__wOU1f",trainOfThought:"chatHistory_trainOfThought__mMWSR"}}}]);