"use strict";(self.webpackChunkjupyterlab_a11y_checker=self.webpackChunkjupyterlab_a11y_checker||[]).push([[509],{509:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var l=n(869),o=n(528),r=n(30),a=n(256),s=n(916),i=n(854),c=n.n(i);async function d(e){return new Promise(((t,n)=>{const l=new Image;l.crossOrigin="Anonymous";try{new URL(e),l.src=e}catch(t){var o=`${document.location.origin}/files/${e}`;l.src=o}try{l.onload=async()=>{const e=document.createElement("canvas");e.width=l.width,e.height=l.height;const n=e.getContext("2d");if(!n)return void t("21 contrast 21.00:1");n.drawImage(l,0,0);var o=n.getImageData(0,0,e.width,e.height);let r;try{r=await async function(e,t,n){const l=(await c().recognize(t,"eng",{})).data.words;if(0===l.length)throw new Error("No text found in the image");let o=21;return l.forEach((t=>{if(t.confidence>=85&&"|"!=t.text&&"-"!=t.text&&"_"!=t.text&&"/"!=t.text&&"="!=t.text){const r=t.bbox,a={},s=e.data,i=e.width;for(let e=r.y0;e<=r.y1;e++)for(let t=r.x0;t<=r.x1;t++){const l=4*(e*i+t),{r:o,g:r,b:c}={r:s[l],g:s[l+1],b:s[l+2]},d="#"+((1<<24)+(Math.floor(o/n)*n<<16)+(Math.floor(r/n)*n<<8)+Math.floor(c/n)*n).toString(16).slice(1).toUpperCase();a[d]=(a[d]||0)+1}var l=Object.entries(a).sort(((e,t)=>t[1]-e[1]))[0][0];let c=function(e,t){function n(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}}function l(e){const t=[e.r,e.g,e.b].map((function(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}));return.2126*t[0]+.7152*t[1]+.0722*t[2]}try{return function(e,t){const o=n(e),r=n(t),a=l(o),s=l(r);return(Math.max(a,s)+.05)/(Math.min(a,s)+.05)}(e,t)}catch(e){return 21}}(Object.entries(a).sort(((e,t)=>t[1]-e[1]))[1][0],l);c<o&&(o=c)}})),o}(o,l.src,30)}catch(e){console.error(e),r=21}t(`${r} contrast ${r.toFixed(2)}:1`)}}catch(e){t("21 contrast 21.00:1")}}))}function h(e,t){return new Promise(((t,n)=>{const l=new Image;l.crossOrigin="Anonymous";try{new URL(e),l.src=e}catch(t){var o=`${document.location.origin}/files/${e}`;l.src=o}try{l.onload=()=>{const e=document.createElement("canvas");e.width=l.width,e.height=l.height;const n=e.getContext("2d");if(!n)return void t("10 transp");n.drawImage(l,0,0);const o=n.getImageData(0,0,e.width,e.height).data;let r=0;const a=o.length/4;for(let e=3;e<o.length;e+=4)o[e]<255&&r++;t(10-r/a*100/10+" transp")}}catch(e){console.log("Failed to get canvas context"),t("10 transp")}}))}async function g(e,t,n){return new Promise((async(t,n)=>{const l=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("img");let o=[];for(let e=0;e<l.length;e++){const t=l[e];t.hasAttribute("alt")&&""!==t.getAttribute("alt")||o.push("Alt")}const r=Array.from(l).map((e=>h(e.src))),a=await Promise.all(r),s=Array.from(l).map((e=>d(e.src))),i=await Promise.all(s);o=[...o,...a.map(String),...i.map(String)],t(o)}))}async function u(e,t){try{if("markdown"==e.model.type){const t=e.model.toJSON().source.toString(),n=await async function(e){return new Promise((async(t,n)=>{const l=/!\[.*?\]\((.*?)\)/g;let o,r=[];const a=[];for(;null!==(o=l.exec(e));){const e=o[1];e&&a.push(e)}/!\[\](\([^)]+\))/g.test(e)&&r.push("Alt");const s=Array.from(a).map((e=>h(e))),i=await Promise.all(s),c=Array.from(a).map((e=>d(e))),g=await Promise.all(c);r=[...r,...i.map(String),...g.map(String)],t(r)}))}(t,document.body.style.getPropertyValue("--fill-color"));return(await g(t,0,document.body.style.getPropertyValue("--fill-color"))).concat(n)}return[]}catch(e){return[]}}async function m(e,t){try{if("code"==e.model.type){const t=e.outputArea.node.outerHTML;return await g(t,0,document.body.style.getPropertyValue("--fill-color"))}return[]}catch(e){return[]}}async function p(e,t,n,l,o){const r=[];e.widgets.forEach((async e=>{if(n()){if(o){f(t,e,[]);const n=await u(e),o=await m(e);var l=n.concat(o);f(t,e,l)}if("markdown"===e.model.type){const t=e,n=t.model.toJSON().source.toString(),l=/^(#+) \s*(.*)$/gm,o=/<h(\d+)>(.*?)<\/h\1>/gi;let a;for(;null!==(a=l.exec(n));){const e=a[1].length;r.push({headingLevel:e,heading:`${a[2].trim()}`,myCell:t})}for(;null!==(a=o.exec(n));){const e=parseInt(a[1]);r.push({headingLevel:e,heading:`${a[2].trim()}`,myCell:t})}}if(r.length>0){let e=r[0].headingLevel,n=e;const l=[];r.forEach(((t,o)=>{t.headingLevel>e+1?l.push({myCell:t.myCell,current:`h${t.headingLevel}`,expected:`h${e+1}`}):t.headingLevel<n&&l.push({myCell:t.myCell,current:`h${t.headingLevel}`,expected:`h${n}`}),e=t.headingLevel})),l.forEach((e=>{f(t,e.myCell,[]),f(t,e.myCell,["heading "+e.current+" "+e.expected])}))}}else f(t,e,[])})),t.showOnlyVisibleCells()}async function y(e,t,n,l,o){n.model.contentChanged.connect((async(o,r)=>{await p(e,t,l,0,!1),f(t,n,[]);const a=await u(n),s=await m(n);var i=a.concat(s);f(t,n,i)}))}function f(e,t,n){var l,o;try{o="accessibility-indicator-"+t.model.id}catch(e){return}for(e.removeCell(t.model.id);document.getElementById(o);)null===(l=document.getElementById(o))||void 0===l||l.remove();let r=!1;for(let l=0;l<n.length;l++)if("heading"==n[l].slice(0,7))e.addCell(t.model.id,"Heading format: expecting "+n[l].slice(11,13)+", got "+n[l].slice(8,10)),r=!0;else if("contrast"==n[l].split(" ")[1])(a=Number(n[l].split(" ")[0]))<4.5&&(e.addCell(t.model.id,"Cell Error: Text Contrast "+n[l].split(" ")[2]),r=!0);else if("Alt"==n[l])e.addCell(t.model.id,"Cell Error: Missing Alt Tag"),r=!0;else{var a;(a=Number(n[l].split(" ")[0]))<9&&(e.addCell(t.model.id,"Image Err: High Image Transparency ("+(10*(10-a)).toFixed(2)+"%)"),r=!0)}if(r){if(!document.getElementById(o)){var s=document.createElement("div");s.id=o,s.style.position="absolute",s.style.top="30px",s.style.left="45px",s.style.width="15px",s.style.height="15px",s.style.borderRadius="50%",s.style.backgroundColor="#ff8080",t.node.appendChild(s)}}else{let n=document.getElementById(o);null==n||n.remove(),e.removeCell(t.model.id)}}const w={id:"jupyterlab_accessibility:plugin",autoStart:!0,requires:[o.INotebookTracker,l.ILabShell],activate:(e,t,n)=>{console.log("JupyterLab extension jupyterlab_accessibility is activated!");let l=!0;const o=()=>{l=!l,console.log(`Accessibility checks ${l?"enabled":"disabled"}.`)},a=new s.LabIcon({name:"accessibility",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#154F92" d="M256 48c114.953 0 208 93.029 208 208 0 114.953-93.029 208-208 208-114.953 0-208-93.029-208-208 0-114.953 93.029-208 208-208m0-40C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 56C149.961 64 64 149.961 64 256s85.961 192 192 192 192-85.961 192-192S362.039 64 256 64zm0 44c19.882 0 36 16.118 36 36s-16.118 36-36 36-36-16.118-36-36 16.118-36 36-36zm117.741 98.023c-28.712 6.779-55.511 12.748-82.14 15.807.851 101.023 12.306 123.052 25.037 155.621 3.617 9.26-.957 19.698-10.217 23.315-9.261 3.617-19.699-.957-23.316-10.217-8.705-22.308-17.086-40.636-22.261-78.549h-9.686c-5.167 37.851-13.534 56.208-22.262 78.549-3.615 9.255-14.05 13.836-23.315 10.217-9.26-3.617-13.834-14.056-10.217-23.315 12.713-32.541 24.185-54.541 25.037-155.621-26.629-3.058-53.428-9.027-82.141-15.807-8.6-2.031-13.926-10.648-11.895-19.249s10.647-13.926 19.249-11.895c96.686 22.829 124.283 22.783 220.775 0 8.599-2.03 17.218 3.294 19.249 11.895 2.029 8.601-3.297 17.219-11.897 19.249z"/></svg>'}),i=new C(t);i.id="AltCellList",i.title.icon=a,n.add(i,"right"),n.activateById("AltCellList"),t.currentChanged.connect(((e,n)=>{n&&n.context.ready.then((()=>{const{content:e}=n;e.widgets.forEach((async n=>{y(e,i,n,(()=>l),t.currentWidget.context.path)})),p(e,i,(()=>l),t.currentWidget.context.path,!0),e.model&&e.model.cells.changed.connect(((n,o)=>{"add"===o.type&&o.newValues.forEach((async n=>{const o=e.widgets.find((e=>e.model.id===n.id));o&&(y(e,i,o,(()=>l),t.currentWidget.context.path),await p(e,i,(()=>l),t.currentWidget.context.path,!0))}))}))}))})),t.widgetAdded.connect(((e,a)=>{var s;null===(s=t.currentWidget)||void 0===s||s.context.ready.then((()=>{try{console.log("trying to add toolbar button"),console.log(t.currentWidget),async function(e,t,n,l,o){const a=new r.ToolbarButton({label:"ðŸŒ a11y Checker",onClick:()=>{o(),l()?e.activateById("AltCellList"):e.collapseRight(),p(n.content,t,l,0,!0)},tooltip:"Toggle Alt-text Check"});a.id="alt-text-check-toggle",n.toolbar.insertItem(0,"altTextCheck",a),document.getElementById("alt-text-check-toggle").style.backgroundColor="#0000"}(n,i,a,(()=>l),o,t.currentWidget.context.path),console.log("able to add toolbar button")}catch(e){console.log("trying again to add toolbar button")}}))}))}};class C extends a.Widget{constructor(e){super(),this._cellMap=new Map,this._listCells=document.createElement("div"),this._notebookTracker=e;let t=document.createElement("h2");t.innerHTML="Cells with Accessibility Issues",t.style.margin="15px",this.node.appendChild(t),this.node.appendChild(this._listCells)}addCell(e,t){const n=document.createElement("div");n.id="cell-"+e+"_"+t;const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.flexWrap="nowrap";const o=document.createElement("button");o.classList.add("jp-toast-button"),o.classList.add("jp-mod-link"),o.classList.add("jp-mod-small"),o.classList.add("jp-Button"),o.style.margin="5px",o.style.marginRight="5px",o.style.marginLeft="7px",o.style.flexShrink="1",o.textContent=t,o.addEventListener("click",(()=>{this.scrollToCell(e)}));const r=document.createElement("span");r.innerHTML="&#9432;",r.style.cursor="pointer",r.style.marginRight="5px";const a=document.createElement("div");a.style.display="none",a.style.marginLeft="50px",a.style.marginRight="50px",a.style.backgroundColor="white",a.style.border="1px solid black",a.style.padding="5px";const s=document.createElement("a");t.includes("Transparency")?(s.href="https://www.w3.org/WAI/WCAG21/Understanding/use-of-color.html",s.textContent="WCAG transparency guidelines"):t.includes("Heading")?(s.href="https://www.w3.org/WAI/tutorials/page-structure/headings/",s.textContent="WCAG headings guidelines"):t.includes("Alt")?(s.href="https://www.w3.org/TR/WCAG20-TECHS/H37.html",s.textContent="WCAG alt-text guidelines"):t.includes("Contrast")&&(s.href="https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html",s.textContent="WCAG text color contrast guidelines"),s.style.color="#069",s.style.textDecoration="underline",s.target="_blank",a.appendChild(s),r.addEventListener("click",(()=>{a.style.display="none"===a.style.display?"block":"none"}));var i=!0;if(this._cellMap.has(e)){var c=this._cellMap.get(e);c.forEach((e=>{e.textContent==t&&(i=!1)})),c.push(n),this._cellMap.set(e,c)}else this._cellMap.set(e,[n]);i&&(l.appendChild(o),l.appendChild(r),n.appendChild(l),n.appendChild(a),this._listCells.appendChild(n))}removeCell(e){const t=this._cellMap.get(e);null!=t&&t.forEach((e=>{for(let t of this._listCells.children)e.id==t.id&&this._listCells.removeChild(e)})),this._cellMap.has(e)&&this._cellMap.delete(e)}scrollToCell(e){const t=this._notebookTracker.currentWidget.content;for(let n=0;n<t.widgets.length;n++){const l=t.widgets[n];if(l.model.id===e){l.node.scrollIntoView({behavior:"auto",block:"center"});const e=l.node.style.transition;l.node.style.transition="background-color 0.5s ease",l.node.style.backgroundColor="#ffff99",setTimeout((()=>{l.node.style.backgroundColor="",l.node.style.transition=e}),800)}}}showOnlyVisibleCells(){console.log("showing only visible cells");var e=Array.from(this._cellMap.keys());const t=this._notebookTracker.currentWidget.content;e.forEach((e=>{var n=!1;for(let l=0;l<t.widgets.length;l++)if(t.widgets[l].model.id===e){n=!0;break}n||this.removeCell(e)}))}}const b=w}}]);